<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <title>Ú†Øª Ø±ÙˆÙ… Ø¨Ù„Ø§Ø¯Ø±Ù†Ú¯ (Real-Time Chat)</title>
Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
Â  Â  <style>
Â  Â  Â  Â  /* Ø´Ø¨ÛŒÙ‡ Ø³Ø§Ø²ÛŒ Ø¸Ø§Ù‡Ø± Ú¯ÙˆÚ¯Ù„ Ú†Øª */
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: Tahoma, sans-serif;
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  Â  Â  background-color: #f0f2f5; /* Ø±Ù†Ú¯ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ù„Ø§ÛŒØª */
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  min-height: 100vh;
Â  Â  Â  Â  }
Â  Â  Â  Â  .chat-container {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  max-width: 700px;
Â  Â  Â  Â  Â  Â  height: 90vh;
Â  Â  Â  Â  Â  Â  background-color: #fff;
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  }
Â  Â  Â  Â  .header {
Â  Â  Â  Â  Â  Â  background-color: #1a73e8; /* Ø±Ù†Ú¯ Ø§ØµÙ„ÛŒ Ú¯ÙˆÚ¯Ù„ */
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  font-size: 1.2em;
Â  Â  Â  Â  }
Â  Â  Â  Â  #chat-box {
Â  Â  Â  Â  Â  Â  flex-grow: 1;
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  overflow-y: auto;
Â  Â  Â  Â  Â  Â  border-bottom: 1px solid #ddd;
Â  Â  Â  Â  }
Â  Â  Â  Â  .message {
Â  Â  Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  Â  Â  Â  padding: 8px 12px;
Â  Â  Â  Â  Â  Â  border-radius: 18px;
Â  Â  Â  Â  Â  Â  max-width: 70%;
Â  Â  Â  Â  Â  Â  word-wrap: break-word;
Â  Â  Â  Â  Â  Â  line-height: 1.4;
Â  Â  Â  Â  }
Â  Â  Â  Â  .message.self {
Â  Â  Â  Â  Â  Â  background-color: #e2f3ff; /* Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ù…Ù† */
Â  Â  Â  Â  Â  Â  margin-right: auto;
Â  Â  Â  Â  Â  Â  border-bottom-right-radius: 4px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .message.other {
Â  Â  Â  Â  Â  Â  background-color: #f1f0f0; /* Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø¯ÛŒÚ¯Ø±Ø§Ù† */
Â  Â  Â  Â  Â  Â  margin-left: auto;
Â  Â  Â  Â  Â  Â  border-bottom-left-radius: 4px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .message .username {
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  display: block;
Â  Â  Â  Â  Â  Â  margin-bottom: 3px;
Â  Â  Â  Â  Â  Â  font-size: 0.8em;
Â  Â  Â  Â  Â  Â  color: #1a73e8;
Â  Â  Â  Â  }
Â  Â  Â  Â  .status-message {
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  font-style: italic;
Â  Â  Â  Â  Â  Â  color: #666;
Â  Â  Â  Â  Â  Â  margin: 10px 0;
Â  Â  Â  Â  }
Â  Â  Â  Â  #message-form {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  Â  Â  border-top: 1px solid #eee;
Â  Â  Â  Â  }
Â  Â  Â  Â  #message-input {
Â  Â  Â  Â  Â  Â  flex-grow: 1;
Â  Â  Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  Â  Â  border: 1px solid #ccc;
Â  Â  Â  Â  Â  Â  border-radius: 20px;
Â  Â  Â  Â  Â  Â  margin-left: 10px;
Â  Â  Â  Â  Â  Â  font-size: 1em;
Â  Â  Â  Â  }
Â  Â  Â  Â  #send-button {
Â  Â  Â  Â  Â  Â  background-color: #1a73e8;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  padding: 10px 20px;
Â  Â  Â  Â  Â  Â  border-radius: 20px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  font-size: 1em;
Â  Â  Â  Â  Â  Â  transition: background-color 0.2s;
Â  Â  Â  Â  }
Â  Â  Â  Â  #send-button:hover {
Â  Â  Â  Â  Â  Â  background-color: #1764c9;
Â  Â  Â  Â  }
Â  Â  Â  Â  #username-prompt {
Â  Â  Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  background-color: rgba(0, 0, 0, 0.5);
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  z-index: 100;
Â  Â  Â  Â  }
Â  Â  Â  Â  .prompt-box {
Â  Â  Â  Â  Â  Â  background-color: white;
Â  Â  Â  Â  Â  Â  padding: 30px;
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  .prompt-box input {
Â  Â  Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  Â  Â  margin: 10px 0;
Â  Â  Â  Â  Â  Â  border: 1px solid #ccc;
Â  Â  Â  Â  Â  Â  border-radius: 4px;
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>

<div id="username-prompt">
Â  Â  <div class="prompt-box">
Â  Â  Â  Â  <h3>Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯</h3>
Â  Â  Â  Â  <input type="text" id="username-input" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø³Ø§Ø±Ø§">
Â  Â  Â  Â  <button id="start-chat-button">ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ú†Øª</button>
Â  Â  </div>
</div>

<div class="chat-container" id="chat-app" style="display: none;">
Â  Â  <div class="header">
Â  Â  Â  Â  Ú¯ÙØªÚ¯ÙˆÛŒ Ø¬Ù‡Ø§Ù†ÛŒ ğŸŒ
Â  Â  </div>
Â  Â  <div id="chat-box">
Â  Â  Â  Â  </div>
Â  Â  <form id="message-form">
Â  Â  Â  Â  <input type="text" id="message-input" placeholder="ÛŒÚ© Ù¾ÛŒØ§Ù… Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..." autocomplete="off">
Â  Â  Â  Â  <button id="send-button" type="submit">Ø§Ø±Ø³Ø§Ù„</button>
Â  Â  </form>
</div>

<script>
Â  Â  let socket;
Â  Â  let username = '';
Â  Â  // room_id Ø±Ø§ Ø«Ø§Ø¨Øª Ø¯Ø± Ù†Ø¸Ø± Ù…ÛŒ Ú¯ÛŒØ±ÛŒÙ… Ú†ÙˆÙ† Ú†Øª Ø¬Ù‡Ø§Ù†ÛŒ Ø§Ø³Øª
Â  Â  const room_id = 'global_chat_room'; 
Â  Â  const chatBox = document.getElementById('chat-box');
Â  Â  const messageInput = document.getElementById('message-input');
Â  Â  const messageForm = document.getElementById('message-form');
Â  Â  const usernameInput = document.getElementById('username-input');
Â  Â  const startChatButton = document.getElementById('start-chat-button');
Â  Â  const usernamePrompt = document.getElementById('username-prompt');
Â  Â  const chatApp = document.getElementById('chat-app');

Â  Â  // --- ØªÙˆØ§Ø¨Ø¹ Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ ---
Â  Â  function displayMessage(data, type) {
Â  Â  Â  Â  const msgDiv = document.createElement('div');
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (type === 'status') {
Â  Â  Â  Â  Â  Â  msgDiv.className = 'status-message';
Â  Â  Â  Â  Â  Â  msgDiv.textContent = data.msg;
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  msgDiv.className = 'message';
Â  Â  Â  Â  Â  Â  if (data.username === username) {
Â  Â  Â  Â  Â  Â  Â  Â  msgDiv.classList.add('self');
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  msgDiv.classList.add('other');
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // Û±. Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ (Bold)
Â  Â  Â  Â  Â  Â  Â  Â  const userSpan = document.createElement('span');
Â  Â  Â  Â  Â  Â  Â  Â  userSpan.className = 'username';
Â  Â  Â  Â  Â  Â  Â  Â  userSpan.textContent = data.username;
Â  Â  Â  Â  Â  Â  Â  Â  msgDiv.appendChild(userSpan);
Â  Â  Â  Â  Â  Â  Â  Â  
                // ğŸ”‘ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¬Ø¯Ø§Ú©Ù†Ù†Ø¯Ù‡ " Ú¯ÙØª: "
                const separator = document.createTextNode(' Ú¯ÙØª: ');
                msgDiv.appendChild(separator);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  // Û². Ù…ØªÙ† Ù¾ÛŒØ§Ù…
Â  Â  Â  Â  Â  Â  const content = document.createTextNode(data.msg);
Â  Â  Â  Â  Â  Â  msgDiv.appendChild(content);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  chatBox.appendChild(msgDiv);
Â  Â  Â  Â  // Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¨Ù‡ Ù¾Ø§ÛŒÛŒÙ† Ú†Øª
Â  Â  Â  Â  chatBox.scrollTop = chatBox.scrollHeight;
Â  Â  }

Â  Â  // --- Ù…Ù†Ø·Ù‚ WebSocket ---
Â  Â  function connectToChat(user) {
Â  Â  Â  Â  username = user;
Â  Â  Â  Â  
Â  Â  Â  Â  // Ø§ØªØµØ§Ù„ Ø¨Ø¯ÙˆÙ† Ø¢Ø¯Ø±Ø³ Ø¯Ù‡ÛŒ Ù…Ø³ØªÙ‚ÛŒÙ… Ø¨Ø±Ø§ÛŒ Ø±ÙØ¹ Ø®Ø·Ø§ÛŒ Mixed Content
Â  Â  Â  Â  socket = io();

Â  Â  Â  Â  // Û±. Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø§ØªØµØ§Ù„
Â  Â  Â  Â  socket.on('connect', function() {
Â  Â  Â  Â  Â  Â  // Ø§Ø±Ø³Ø§Ù„ Ø±ÙˆÛŒØ¯Ø§Ø¯ join Ø¨Ù‡ Ø³Ø±ÙˆØ±
Â  Â  Â  Â  Â  Â  socket.emit('join', { username: username, room: room_id });
Â  Â  Â  Â  Â  Â  usernamePrompt.style.display = 'none';
Â  Â  Â  Â  Â  Â  chatApp.style.display = 'flex';
Â  Â  Â  Â  Â  Â  messageInput.focus();
Â  Â  Â  Â  });

Â  Â  Â  Â  // Û². Ø¯Ø±ÛŒØ§ÙØª Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ ÙˆØ¶Ø¹ÛŒØª (ÙˆØ±ÙˆØ¯/Ø®Ø±ÙˆØ¬)
Â  Â  Â  Â  socket.on('status', function(data) {
Â  Â  Â  Â  Â  Â  displayMessage(data, 'status');
Â  Â  Â  Â  });
        
        // Û³. Ø¯Ø±ÛŒØ§ÙØª Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ (Ø±ÙˆÛŒØ¯Ø§Ø¯ new_message Ø§Ø² app.py)
Â  Â  Â  Â  socket.on('new_message', function(data) {
Â  Â  Â  Â  Â  Â  displayMessage(data, 'chat');
Â  Â  Â  Â  });

Â  Â  Â  Â  // Û´. Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø±Ø³Ø§Ù„ ÙØ±Ù…
Â  Â  Â  Â  messageForm.onsubmit = function(e) {
Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  const msg = messageInput.value.trim();
Â  Â  Â  Â  Â  Â  if (msg) {
Â  Â  Â  Â  Â  Â  Â  Â  // Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø¨Ù‡ Ø³Ø±ÙˆØ± Ø¨Ø§ Ø±ÙˆÛŒØ¯Ø§Ø¯ send_message
Â  Â  Â  Â  Â  Â  Â  Â  socket.emit('send_message', { username: username, msg: msg, room: room_id });
Â  Â  Â  Â  Â  Â  Â  Â  messageInput.value = '';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };
        
        // Ûµ. Ø±ÙˆÛŒØ¯Ø§Ø¯ Ù‚Ø·Ø¹ Ø§ØªØµØ§Ù„
        window.addEventListener('beforeunload', function() {
            if(socket) {
                socket.emit('left');
            }
        });

Â  Â  }

Â  Â  // --- Ù…Ø¯ÛŒØ±ÛŒØª ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø± ---
Â  Â  startChatButton.onclick = function() {
Â  Â  Â  Â  const user = usernameInput.value.trim();
Â  Â  Â  Â  if (user) {
Â  Â  Â  Â  Â  Â  connectToChat(user);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  alert('Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.');
Â  Â  Â  Â  }
Â  Â  };
Â  Â Â 
Â  Â  // Ø§Ø¬Ø§Ø²Ù‡ ÙˆØ±ÙˆØ¯ Ø¨Ø§ Ø²Ø¯Ù† Enter Ø¯Ø± ÙÛŒÙ„Ø¯ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ
Â  Â  usernameInput.addEventListener('keypress', function(e) {
Â  Â  Â  Â  if (e.key === 'Enter') {
Â  Â  Â  Â  Â  Â  startChatButton.click();
Â  Â  Â  Â  }
Â  Â  });

</script>

</body>
</html>